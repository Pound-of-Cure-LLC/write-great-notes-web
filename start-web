#!/bin/bash

# Kill any process running on port 3010
lsof -ti:3010 | xargs kill -9 2>/dev/null

# Start the Next.js dev server on port 3010, auto-restart on crash
while true; do
  echo "Starting Next.js dev server..."
  npm run dev -- -p 3010

  EXIT_CODE=$?
  if [ $EXIT_CODE -eq 0 ]; then
    # Clean exit (Ctrl+C), don't restart
    echo "Server stopped cleanly."
    break
  fi

  echo ""
  echo "Server crashed with exit code $EXIT_CODE. Restarting in 2 seconds..."
  echo ""
  sleep 2
done
